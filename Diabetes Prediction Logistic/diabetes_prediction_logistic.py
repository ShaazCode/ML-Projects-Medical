# -*- coding: utf-8 -*-
"""Diabetes_Prediction_Logistic.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1V_X1tt1uhAGZDq8vXEdgpvYCGSLIQD3G
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

df = pd.read_csv("diabetes_eda_dataset_2000.csv")

df.shape

df.info()

df.describe()

df.isnull().sum()

sns.boxplot(df['Glucose'])

sns.boxplot(df['BloodPressure'])

sns.boxplot(df['Insulin'])

sns.boxplot(df['BMI'])

df['BMI'] = df['BMI'].fillna(df['BMI'].mean())

df['Glucose'] = df['Glucose'].fillna(df['Glucose'].mean())

df['BloodPressure'] = df['BloodPressure'].fillna(df['BloodPressure'].mean())

df['Insulin'] = df['Insulin'].fillna(df['Insulin'].mean())

df.info()

# Feature Enginnering

df["BMI_Category"] = pd.cut(
    df["BMI"],
    bins=[0, 18.5, 25, 30, 100],
    labels=["Underweight", "Normal", "Overweight", "Obese"]
)

df = pd.get_dummies(df, columns=["BMI_Category"], drop_first=True)

df["Age_Group"] = pd.cut(
    df["Age"],
    bins=[20, 30, 40, 50, 100],
    labels=["Young", "Adult", "MidAge", "Senior"]
)

df = pd.get_dummies(df, columns=["Age_Group"], drop_first=True)

df["High_Glucose"] = np.where(df["Glucose"] >= 140, 1, 0)

df["Insulin_Flag"] = np.where(df["Insulin"] > 0, 1, 0)

df.drop("SkinThickness", axis=1, inplace=True)

X = df.drop("Outcome", axis=1)
y = df["Outcome"]

from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

X

y

X_scaled = pd.DataFrame(X_scaled, columns=X.columns)

from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(
    X_scaled, y, test_size=0.2, random_state=42
)

from sklearn.linear_model import LogisticRegression

model = LogisticRegression()
model.fit(X_train, y_train)

y_pred = model.predict(X_test)

y_pred_prob = model.predict_proba(X_test)

from sklearn.metrics import confusion_matrix

cm = confusion_matrix(y_test, y_pred)
cm

# Accuracy

from sklearn.metrics import accuracy_score

accuracy = accuracy_score(y_test, y_pred)
accuracy

from sklearn.metrics import classification_report

print(classification_report(y_test, y_pred))

import pandas as pd
import numpy as np

def predict_diabetes(Pregnancies, Glucose, BloodPressure, Insulin, BMI, DiabetesPedigreeFunction, Age):
    new_df = pd.DataFrame([{
        "Pregnancies": Pregnancies,
        "Glucose": Glucose,
        "BloodPressure": BloodPressure,
        "Insulin": Insulin,
        "BMI": BMI,
        "DiabetesPedigreeFunction": DiabetesPedigreeFunction,
        "Age": Age
    }])

    # Feature engineering
    new_df["High_Glucose"] = np.where(new_df["Glucose"] >= 140, 1, 0)
    new_df["Insulin_Flag"] = np.where(new_df["Insulin"] > 0, 1, 0)

    # Align with training columns
    for col in X.columns:
        if col not in new_df.columns:
            new_df[col] = 0
    new_df = new_df[X.columns]

    # Scale and predict
    new_scaled = scaler.transform(new_df)
    pred = model.predict(new_scaled)[0]

    return "Yes" if pred == 1 else "No"

# Example usage
result = predict_diabetes(2, 160, 75, 130, 32, 0.6, 45)
print("Diabetes Prediction:", result)

